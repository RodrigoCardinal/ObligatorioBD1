{% extends "base.html" %}
{% block title %}Reservas | Sistema de Salas{% endblock %}

{% block hero_title %}
  <h1 class="hero-title mb-1">Detalle de la reserva</h1>
  <p class="hero-sub mb-0"> ConsultÃ¡ toda la informaciÃ³n de la reserva</p>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row g-4">
    <!-- Columna izquierda: Detalles -->
    <div class="col-lg-8">
      <div class="card p-4">
        <h2 class="section-title mb-3">{{ r.nombre_sala }}</h2>
        <img src="{{ img }}" alt="Sala" class="room-cover mb-4">

        <table class="table table-borderless mb-0">
          <tbody>
            <tr>
              <th scope="row">ğŸ“… Fecha:</th>
              <td>{{ r.fecha.strftime("%d/%m/%Y") }}</td>
            </tr>
            <tr>
              <th scope="row">ğŸ• Horario:</th>
              <td>{{ r.hora_inicio }} â€“ {{ r.hora_fin }}</td>
            </tr>
            <tr>
              <th scope="row">ğŸ›ï¸ Edificio:</th>
              <td>{{ r.edificio }}</td>
            </tr>
            <tr>
              <th scope="row">ğŸ“ DirecciÃ³n:</th>
              <td>{{ r.direccion if r.direccion else "No especificada" }}</td>
            </tr>
            <tr>
              <th scope="row">ğŸ’º Capacidad:</th>
              <td>{{ r.capacidad }} personas</td>
            </tr>
            <tr>
              <th scope="row">ğŸ§© Tipo de sala:</th>
              <td>{{ r.tipo_sala }}</td>
            </tr>
            <tr>
              <th scope="row">ğŸ”– Estado:</th>
              <td>
                {% if r.estado == "activa" %}
                  <span class="badge bg-success">Activa</span>
                {% elif r.estado == "finalizada" %}
                  <span class="badge bg-secondary">Finalizada</span>
                {% else %}
                  <span class="badge bg-warning text-dark">{{ r.estado }}</span>
                {% endif %}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Columna derecha: Participantes -->
    <div class="col-lg-4">
      <div class="card p-4 h-100">
        <h3 class="section-title mb-3">Participantes</h3>

        {% if participantes %}
          <ul class="list-group list-group-flush">
            {% for p in participantes %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ p.nombre }}
                {% if p.asistencia == 1 %}
                  <span class="badge bg-success">AsistiÃ³</span>
                {% else %}
                  <span class="badge bg-secondary">Pendiente</span>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">No hay participantes registrados aÃºn.</p>
        {% endif %}
      </div>
    </div>
  </div>

    <!-- Botones de acciÃ³n -->
  <div class="text-center mt-5">
    {% if not usuario_en_reserva %}
      <form method="POST" action="{{ url_for('reservas_unirse') }}" class="d-inline-block" style="max-width: 320px;">
        <input type="hidden" name="id_reserva" value="{{ r.id_reserva }}">

        <!-- ğŸ”‘ AQUÃ SE PIDE LA CONTRASEÃ‘A PARA UNIRSE -->
        <div class="mb-3 text-start">
          <label class="form-label" for="join-pass">ContraseÃ±a de la reserva</label>
          <input id="join-pass" name="clave_reserva" type="password" class="form-control" required>
        </div>

        <button type="submit" class="btn btn-primary px-4 py-2">Unirme a la reserva</button>
      </form>
    {% else %}
      <form method="POST" action="{{ url_for('baja_reserva', id=r.id_reserva) }}">
        <button type="submit" class="btn btn-outline-primary px-4 py-2">Darme de baja</button>
      </form>
    {% endif %}
  </div>


</div>
{% endblock %}
